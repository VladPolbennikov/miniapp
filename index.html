<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mini App</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="container">
    <header class="app-header">
      <img src="logo.jpg" alt="Bot logo" class="app-logo" />
      <div class="app-header-text">
        <h1 class="app-title">Pamela English Tutor</h1>
        <p class="app-subtitle">–ì–ª–∞–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –º–µ–Ω—é –±–æ—Ç–∞</p>
      </div>
    </header>

    <main class="actions">
      <section class="action">
        <button class="btn btn-primary" type="button" id="btn-stats" aria-label="–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
          <span class="btn-icon">üìä</span>
          <span class="btn-text">–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è</span>
        </button>
      </section>

      <section class="action">
        <button class="btn btn-neutral" type="button" id="btn-speed" aria-label="–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏">
          <span class="btn-icon">‚è±Ô∏è</span>
          <span class="btn-text">–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ –±–æ—Ç–∞</span>
        </button>
      </section>

      <section class="action">
        <button class="btn btn-neutral" type="button" id="btn-voice" aria-label="–í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞">
          <span class="btn-icon">üéôÔ∏è</span>
          <span class="btn-text">–ò–∑–º–µ–Ω–∏—Ç—å –æ–∑–≤—É—á–∫—É –≥–æ–ª–æ—Å–∞</span>
        </button>
      </section>

      <section class="action">
        <button class="btn btn-premium" type="button" id="btn-premium" aria-label="–ü—Ä–µ–º–∏—É–º">
          <span class="btn-icon">‚≠ê</span>
          <span class="btn-text">–ö—É–ø–∏—Ç—å –ø—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫—É</span>
        </button>
        <div class="hint">–ë–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–æ–¥–ø–∏—Å–∫–æ–π</div>
      </section>

      <section class="action">
        <button class="btn btn-neutral" type="button" id="btn-support" aria-label="–ü–æ–¥–¥–µ—Ä–∂–∫–∞">
          <span class="btn-icon">üí¨</span>
          <span class="btn-text">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span>
        </button>
      </section>
    </main>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg && typeof tg.ready === 'function') tg.ready();

    // HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
    const ENDPOINT = "https://pamelaenglishbot.ru/webapp";

    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥
    async function sendCommand(command) {
      try {
        const queryId = tg?.initDataUnsafe?.query_id;
        if (!queryId) {
          console.log("query_id –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (Mini App –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ –º–µ–Ω—é/–≤–ª–æ–∂–µ–Ω–∏–π).");
          return;
        }

        const resp = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query_id: queryId, command: command }),
        });

        const data = await resp.json();
        if (!data.ok) {
          console.error("Server error:", data);
          return;
        }

        tg.close();
      } catch (e) {
        console.error(e);
      }
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"
    function showDevModal() {
      const modal = document.getElementById('dev-modal');
      if (!modal) return;
      modal.classList.add('visible');
      // –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ ‚Äî –∞–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      clearTimeout(modal._hideTimeout);
      modal._hideTimeout = setTimeout(() => modal.classList.remove('visible'), 2000);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: –≤—Å–µ –∫–Ω–æ–ø–∫–∏, –∫—Ä–æ–º–µ –ø—Ä–µ–º–∏—É–º, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –º–æ–¥–∞–ª
    const map = {
      stats: 'btn-stats',
      speed: 'btn-speed',
      voice: 'btn-voice',
      support: 'btn-support'
    };

    Object.values(map).forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('click', showDevModal);
    });

    // –ü—Ä–µ–º–∏—É–º ‚Äî —Ä–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
    const premiumBtn = document.getElementById('btn-premium');
    if (premiumBtn) premiumBtn.addEventListener('click', () => sendCommand('premium'));

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –ø–æ –æ–≤–µ—Ä–ª–µ—é/–∫–Ω–æ–ø–∫–µ
    const devModal = document.getElementById('dev-modal');
    if (devModal) {
      devModal.addEventListener('click', (e) => {
        if (e.target.id === 'dev-modal' || e.target.classList.contains('dev-close')) {
          devModal.classList.remove('visible');
        }
      });
    }
  </script>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ -->
  <div id="dev-modal" class="dev-modal" role="dialog" aria-hidden="true">
    <div class="dev-modal-content" role="document">
      <div class="dev-modal-title">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
      <div class="dev-modal-body">–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –û–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</div>
      <button type="button" class="dev-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">–û–ö</button>
    </div>
  </div>
</body>
</html>
