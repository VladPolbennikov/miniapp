<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--tg-theme-bg-color, #111);
        color: var(--tg-theme-text-color, #fff);
        height: 100%;
      }
      .wrap {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        padding: 24px;
      }
      button {
        font-size: 18px;
        padding: 14px 18px;
        border-radius: 12px;
        border: none;
        background: var(--tg-theme-button-color, #2ea6ff);
        color: var(--tg-theme-button-text-color, #fff);
        cursor: pointer;
      }
      button:active { transform: translateY(1px); }
    </style>
  </head>
  <body>
    <div class="wrap">
      <button id="btn-premium">üíé –ü—Ä–µ–º–∏—É–º</button>
    </div>

    <script>
      const tg = window.Telegram.WebApp;
      tg.ready();

      // HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
      const ENDPOINT = "http://194.87.208.6:8080/webapp";
      // –í–∞–∂–Ω–æ: –µ—Å–ª–∏ Mini App –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ HTTPS (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitHub Pages),
      // –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ HTTP (mixed content).
      // –†–µ—à–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ HTTPS –∏–ª–∏ —Ö–æ—Å—Ç–∏—Ç—å Mini App –ø–æ HTTP –≤–º–µ—Å—Ç–µ —Å –±—ç–∫–µ–Ω–¥–æ–º.

      async function sendPremium() {
        try {
          const queryId = tg?.initDataUnsafe?.query_id;
          if (!queryId) {
            // alert("query_id –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (Mini App –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ –º–µ–Ω—é/–≤–ª–æ–∂–µ–Ω–∏–π).");
            return;
          }

          const resp = await fetch(ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query_id: queryId, command: "premium" }),
          });

          const data = await resp.json();
          if (!data.ok) {
            console.error("Server error:", data);
            // alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: " + (data.error || "unknown"));
            return;
          }

          tg.close();
        } catch (e) {
          console.error(e);
          // alert("–û—à–∏–±–∫–∞: " + e.message);
        }
      }

      document
        .getElementById("btn-premium")
        .addEventListener("click", sendPremium);
    </script>
  </body>
</html>
